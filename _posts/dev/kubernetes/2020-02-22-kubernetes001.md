---
title: Kubernetes ê¸°ë³¸ 01
date: 2020-02-22 00:00:00 +0800
excerpt: ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜
header:
  teaser: https://live.staticflickr.com/65535/50118270208_9de7c7ed9d_c.jpg
  overlay_image: https://live.staticflickr.com/65535/50118270208_9de7c7ed9d_c.jpg
  overlay_filter: 0.5
  og_image: https://live.staticflickr.com/65535/50118270208_9de7c7ed9d_c.jpg
  caption: "Photo credit: [**Flickr***](https://live.staticflickr.com)"
categories: kubernetes
---

## 1. ê°œìš”

- ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê²½í—˜í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆìœ¼ë‚˜ ì—¬ê¸°ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ minikubeë¥¼ VirtualBox ê¸°ë°˜ìœ¼ë¡œ ê¸°ë™í•˜ëŠ” ë°©ë²•ì„
ì„¤ëª….
- ì‘ì—… í™˜ê²½ GCP(Google Cloud Platform)


## 2. VM ìƒì„±

- VM ìƒì„±ì€ ì¤‘ì²© ê°€ìƒí™”ê°€ ê°€ëŠ¥í•œ VMì´ í•„ìš”í•˜ë¯€ë¡œ ì•„ë˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬ ìƒì„±


[ì°¸ê³ : VM ì¸ìŠ¤í„´ìŠ¤ìš© ì¤‘ì²© ê°€ìƒí™” ì‚¬ìš© ì„¤ì •](https://cloud.google.com/compute/docs/instances/enable-nested-virtualization-vm-instances#starting_a_nested_vm) <br>

- GCP CLOUD SHELLì—ì„œ ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

**Notice:** GCP CLOUD SHELLì€ ë¦¬ëˆ…ìŠ¤ VM ì¤‘, SSH ì½¤ë³´ë°•ìŠ¤ì˜ gcloud ëª…ë ¹ë³´ê¸° ë©”ë‰´ë¥¼ ì„ íƒí•˜ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆê³  ìµœì´ˆ ì ‘ì†ì‹œ clientì˜ pub key ë“±ë¡ì´ í•„ìš”í•˜ë¯€ë¡œ
ssh-keygen -t rsa -f ~/.ssh/[KEY_FILENAME] -C [USERNAME] ëª…ë ¹ì–´ë¡œ ë¯¸ë¦¬ clientì— rsa pub keyë¥¼ ë§Œë“¤ì–´ ë‘”ë‹¤.
{: .notice--info}

- ìˆ˜í–‰ ìŠ¤í¬ë¦½íŠ¸ 

```sh 

# ë””ìŠ¤í¬ ìƒì„±
gcloud compute disks create disk1 --image-project centos-cloud --image-family centos-7 --zone us-central1-b

# ë””ìŠ¤í¬ ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±
gcloud compute images create nested-vm-image \
  --source-disk disk1 --source-disk-zone us-central1-b \
  --licenses "https://compute.googleapis.com/compute/v1/projects/vm-options/global/licenses/enable-vmx"

# ì´ë¯¸ì§€ë¡œ VM ìƒì„±
gcloud compute instances create gcp-minikube-vm --zone us-central1-b \
              --min-cpu-platform "Intel Haswell" \
              --image nested-vm-image

# VM ì ‘ì†
gcloud compute ssh gcp-minikube-vm 
```

## 3. Dependency ì„¤ì •

[ì°¸ê³ ](http://tonychungblogtest.blogspot.com/2017/10/to-remove-virtualbox-sudo-dpkg-list.html) <br>

- í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜

```sh 
sudo yum update -y
sudo yum install wget
sudo yum install gcc make patch  dkms qt libgomp
sudo yum install kernel-headers kernel-devel fontforge binutils glibc-headers glibc-devel
```

- ì¬ë¶€íŒ…

```sh 
sudo reboot
```

- ì½˜ì†” ì¬ì ‘ì† í›„ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ìƒˆë¡œìš´ ì»¤ë„ë¡œ ê¸°ë™ 

```sh 
export KERN_DIR=/usr/src/kernels/`uname -r`
```

## 4. VirtualBox

```sh 
# yum repository ê²½ë¡œ ë“±ë¡ì„ ìœ„í•´ ë””ë ‰í† ë¦¬ ì´ë™
[*** ]$ cd /etc/yum.repos.d/

# yumìœ¼ë¡œ virtualbox ì„¤ì¹˜ë¥¼ ìœ„í•´ virtualbox repoë¥¼ ë“±ë¡
[*** yum.repos.d]$ sudo wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo

#virtualbox ì„¤ì¹˜
[*** yum.repos.d]$ sudo yum install VirtualBox-6.1
```

## 5. Minikube

```sh 
[*** yum.repos.d]$ sudo curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64   && sudo chmod +x minikube
[*** yum.repos.d]$ sudo mkdir -p /usr/local/bin/
[*** yum.repos.d]$ sudo install minikube /usr/local/bin/
```

### 6. Kubectl

```sh 
[*** yum.repos.d]$ sudo curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
[*** yum.repos.d]$ sudo chmod +x ./kubectl
[*** yum.repos.d]$ sudo mv ./kubectl /usr/local/bin/kubectl

#kubectl ë²„ì „ í™•ì¸ 
[*** yum.repos.d]$ kubectl version --client
```

## 7. minikube ê°€ìƒ ë¨¸ì‹  ì„¤ì¹˜


```sh 
minikube start
```

## 8. ê²°ê³¼ í™”ë©´

```sh 
[*** yum.repos.d]$ minikube start
ğŸ˜„  minikube v1.7.3 on Centos 7.7.1908
âœ¨  Automatically selected the virtualbox driver
ğŸ’¿  Downloading VM boot image ...
    > minikube-v1.7.3.iso.sha256: 65 B / 65 B [--------------] 100.00% ? p/s 0s
    > minikube-v1.7.3.iso: 167.39 MiB / 167.39 MiB [] 100.00% 163.22 MiB p/s 2s
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2000MB, Disk=20000MB) ...
ğŸ³  Preparing Kubernetes v1.17.3 on Docker 19.03.6 ...
ğŸ’¾  Downloading kubelet v1.17.3
ğŸ’¾  Downloading kubeadm v1.17.3
ğŸ’¾  Downloading kubectl v1.17.3
ğŸš€  Launching Kubernetes ...
ğŸŒŸ  Enabling addons: default-storageclass, storage-provisioner
âŒ›  Waiting for cluster to come online ...
ğŸ„  Done! kubectl is now configured to use "minikube"
```

## 9. ë™ì‘ í™•ì¸ 

```sh 
kubectl get nodes
```
